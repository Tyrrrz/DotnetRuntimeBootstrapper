<Project xmlns="http://schemas.microsoft.com/developer/msbuild/2003" ToolsVersion="4.0">

  <Target Name="CheckBootstrapperPrerequisites" AfterTargets="Publish">
    <!-- Warning: not .NET Core -->
    <Warning Text="Project is not targeting .NET Core. Bootstrapper will not be created." Condition="'$(MSBuildRuntimeType)' != 'Core'" />

    <!-- Warning: not Windows executable -->
    <Warning Text="Project output type is not WinExe. Boostrapper will not be created." Condition="'$(OutputType)' != 'WinExe'" />

    <!-- Warning: not Windows target platform -->
    <Warning Text="Target platform is not Windows. Boostrapper will not be created." Condition="'$(TargetPlatformIdentifier)' != 'Windows'" />
  </Target>

  <Target Name="CreateBootstrapperAfterBuild" AfterTargets="Build" Condition="$(GenerateBootstrapperOnBuild) == true AND '$(MSBuildRuntimeType)' == 'Core' AND '$(OutputType)' == 'WinExe' AND '$(TargetPlatformIdentifier)' == 'Windows'">
    <CreateBootstrapperTask TargetFilePath="$(TargetPath)" />
  </Target>

  <Target Name="CreateBootstrapperAfterPublish" AfterTargets="Publish" Condition="'$(MSBuildRuntimeType)' == 'Core' AND '$(OutputType)' == 'WinExe' AND '$(TargetPlatformIdentifier)' == 'Windows'">
    <CreateBootstrapperTask TargetFilePath="$([System.IO.Path]::Combine('$(ProjectDir)', '$(PublishDir)/$(AssemblyName).dll'))" />
  </Target>

</Project>